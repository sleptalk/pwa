<!DOCTYPE html>  
 <html lang="es">  
 
 <head>  
   <meta charset="UTF-8">  
   <meta http-equiv="X-UA-Compatible" content="IE=edge">  
 @@ -28,7 +27,7 @@
     input {  
       padding: 10px;  
       margin-bottom: 10px;  
       width: 200px; /* Ajusta el ancho según sea necesario */  
       width: 200px;  
     }  
     button {  
       padding: 10px;  
 @@ -40,7 +39,6 @@
     }  
   </style>  
 </head>  
 
 <body>  
   <div id="mensajeUbicacion">Obteniendo ubicación...</div>  
   <div id="nombreChofer"></div>  
 @@ -50,91 +48,29 @@
     <button id="btnEnviar">Enviar Código</button>  
   </div>  
 
   <script src="./script.js"></script>  
   <script>  
     let codigoIngresado = false; // Variable para verificar si el código ya fue ingresado  
     let intervaloUbicacion; // Variable para almacenar el intervalo de actualización de ubicación  
 
     // Función para obtener la ubicación  
     function obtenerUbicacion() {  
       console.log("Intentando obtener la ubicación...");  
       if (navigator.geolocation) {  
         navigator.geolocation.getCurrentPosition(  
           function (position) {  
             console.log("Ubicación obtenida:", position.coords.latitude, position.coords.longitude);  
             enviarUbicacion(position.coords.latitude, position.coords.longitude);  
           },  
           function (error) {  
             console.error("Error al obtener la ubicación:", error.message);  
             document.getElementById("mensajeUbicacion").innerText = "Error al obtener la ubicación: " + error.message;  
           }  
         );  
       } else {  
         console.error("Geolocalización no soportada por este navegador.");  
         document.getElementById("mensajeUbicacion").innerText = "Geolocalización no soportada por este navegador.";  
     // Iniciar la obtención de la ubicación  
     function iniciarUbicacion() {  
       if ("serviceWorker" in navigator && navigator.serviceWorker.controller) {  
         navigator.serviceWorker.controller.postMessage("iniciar");  
       }  
     }  
 
     // Función para enviar la ubicación al script de Google Apps Script  
     function enviarUbicacion(latitud, longitud) {  
       const codigoConductor = document.getElementById("codigoConductor").value; // Obtén el código del conductor desde el input  
       if (!codigoConductor) {  
         console.error("Código de conductor no encontrado.");  
         document.getElementById("mensajeUbicacion").innerText = "Primero debes ingresar un código de conductor.";  
         return;  
     // Detener la obtención de la ubicación  
     function detenerUbicacion() {  
       if ("serviceWorker" in navigator && navigator.serviceWorker.controller) {  
         navigator.serviceWorker.controller.postMessage("detener");  
       }  
 
       const url = "https://script.google.com/macros/s/AKfycbx_kg6MTahza8LJ6USXH6DMk15cE19U39IeNuXgslHdQL5zGqiW-5FIBt6gjYLumz8txg/exec";  
       const params = new URLSearchParams({  
         codigo: codigoConductor,  
         latitud: latitud,   
         longitud: longitud
       });  
 
       fetch(url + "?" + params.toString(), {  
         method: "GET",  
         mode: "no-cors" // Modo no-cors para evitar problemas de CORS  
       })  
         .then(() => {  
           console.log("Ubicación enviada correctamente.");  
           document.getElementById("mensajeUbicacion").innerText = "Ubicación actualizada: Latitud " + latitud.toFixed(5) + " | Longitud " + longitud.toFixed(5);  
         })  
         .catch((error) => {  
           console.error("Error al enviar la ubicación:", error);  
           document.getElementById("mensajeUbicacion").innerText = "Error al enviar la ubicación: " + error.message;  
         });  
     }  
 
     // Función para manejar el envío del código del conductor  
     document.getElementById("btnEnviar").addEventListener("click", function() {  
     // Ejemplo: Iniciar la ubicación al ingresar el código del conductor  
     document.getElementById("btnEnviar").addEventListener("click", () => {  
       const codigoConductor = document.getElementById("codigoConductor").value;  
       obtenerNombreConductor(codigoConductor);  
       if (codigoConductor) {  
         iniciarUbicacion();  
       }  
     });  
 
     // Función para obtener el nombre del conductor  
     function obtenerNombreConductor(codigo) {  
       const url = "https://script.google.com/macros/s/AKfycbx_kg6MTahza8LJ6USXH6DMk15cE19U39IeNuXgslHdQL5zGqiW-5FIBt6gjYLumz8txg/exec?codigo=" + codigo;  
 
       fetch(url)  
         .then(response => response.json())  
         .then(data => {  
           if (data.nombre) {  
             document.getElementById("nombreChofer").innerText = "Chofer: " + data.nombre;  
             codigoIngresado = true; // Marcar que el código ha sido ingresado  
             document.getElementById("codigoConductor").disabled = true; // Desactivar el campo de entrada  
             obtenerUbicacion(); // Obtener la ubicación después de ingresar el código  
 
             // Iniciar la actualización de ubicación cada 20 segundos  
             intervaloUbicacion = setInterval(obtenerUbicacion, 20000);  
           } else {  
             document.getElementById("mensajeUbicacion").innerText = "Código no encontrado.";  
           }  
         })  
         .catch(error => {  
           console.error("Error al obtener el nombre del conductor:", error);  
           document.getElementById("mensajeUbicacion").innerText = "Error al obtener el nombre del conductor.";  
         });  
     }  
   </script>  
 </body>  
 
 </html>  
