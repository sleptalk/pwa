<!DOCTYPE html>  
<html lang="es">  

<head>  
  <meta charset="UTF-8">  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  
  <title>Panel de administración</title>  
  <link rel="manifest" href="./manifest.json">  
  <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/16/5868/5868632.png" type="image/x-icon">  
</head>  

<body style="margin: 0; padding: 0; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center;">  
  <div id="mensajeUbicacion" style="padding: 20px; font-family: Arial, sans-serif;">  
    Obteniendo ubicación...  
  </div>  

  <div id="formulario" style="display: flex; flex-direction: column; align-items: center;">  
    <input type="text" id="codigoConductor" placeholder="Ingrese el código del conductor" style="padding: 10px; margin-bottom: 10px;">  
    <button id="btnEnviar" style="padding: 10px;">Enviar Código</button>  
  </div>  

  <script>  
    // Función para obtener la ubicación  
    function obtenerUbicacion() {  
      console.log("Intentando obtener la ubicación...");  
      if (navigator.geolocation) {  
        navigator.geolocation.getCurrentPosition(  
          function (position) {  
            console.log("Ubicación obtenida:", position.coords.latitude, position.coords.longitude);  
            enviarUbicacion(position.coords.latitude, position.coords.longitude);  
          },  
          function (error) {  
            console.error("Error al obtener la ubicación:", error.message);  
            document.getElementById("mensajeUbicacion").innerText = "Error al obtener la ubicación: " + error.message;  
          }  
        );  
      } else {  
        console.error("Geolocalización no soportada por este navegador.");  
        document.getElementById("mensajeUbicacion").innerText = "Geolocalización no soportada por este navegador.";  
      }  
    }  

    // Función para enviar la ubicación al script de Google Apps Script  
    function enviarUbicacion(latitud, longitud) {  
      const codigoConductor = document.getElementById("codigoConductor").value; // Obtén el código del conductor desde el input  
      if (!codigoConductor) {  
        console.error("Código de conductor no encontrado.");  
        document.getElementById("mensajeUbicacion").innerText = "Primero debes ingresar un código de conductor.";  
        return;  
      }  

      const url = "https://script.google.com/macros/s/AKfycbxbtyoWDfdqulykLyqWCAtcKlDeF_fPMmA-Kf3tSV9ZKBQmzBlzf3cUhyQqHEdJGaCeSA/exec";  
      const params = new URLSearchParams({  
        codigo: codigoConductor,  
        latitud: latitud,  
        longitud: longitud  
      });  

      fetch(url + "?" + params.toString(), {  
        method: "GET",  
        mode: "no-cors" // Modo no-cors para evitar problemas de CORS  
      })  
        .then(() => {  
          console.log("Ubicación enviada correctamente.");  
          document.getElementById("mensajeUbicacion").innerText = "Ubicación actualizada: Latitud " + latitud + " | Longitud " + longitud;  
        })  
        .catch((error) => {  
          console.error("Error al enviar la ubicación:", error);  
          document.getElementById("mensajeUbicacion").innerText = "Error al enviar la ubicación: " + error.message;  
        });  
    }  

    // Llama a la función para obtener la ubicación al hacer clic en el botón  
    document.getElementById("btnEnviar").addEventListener("click", function() {  
      obtenerUbicacion();  
    });  
  </script>  
</body>  

</html>  
