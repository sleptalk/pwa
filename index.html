<!DOCTYPE html>  
<html lang="es">  

<head>  
  <meta charset="UTF-8">  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  
  <title>Panel de administración</title>  
  <link rel="manifest" href="./manifest.json">  
  <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/16/5868/5868632.png" type="image/x-icon">  
  <style>  
    body {  
      margin: 0;  
      padding: 0;  
      height: 100vh;  
      display: flex;  
      flex-direction: column;  
      align-items: center;  
      justify-content: center;  
      font-family: Arial, sans-serif;  
    }  

    #formulario {  
      display: flex;  
      flex-direction: column;  
      align-items: center;  
      margin-top: 20px;  
    }  

    input {  
      padding: 10px;  
      margin-bottom: 10px;  
      width: 200px;  
    }  

    button {  
      padding: 10px;  
      cursor: pointer;  
      margin: 5px;  
    }  

    #nombreChofer {  
      margin-top: 10px;  
      font-weight: bold;  
    }  
  </style>  
</head>  

<body>  
  <div id="mensajeUbicacion">Obteniendo ubicación...</div>  
  <div id="nombreChofer"></div>  

  <div id="formulario">  
    <input type="text" id="codigoConductor" placeholder="Ingrese el código del conductor">  
    <button id="btnEnviar">Enviar Código</button>  
  </div>  

  <script>  
    // Función para iniciar la obtención de la ubicación en segundo plano  
    function iniciarUbicacionSegundoPlano(codigoConductor) {  
      if ("serviceWorker" in navigator && navigator.serviceWorker.controller) {  
        navigator.serviceWorker.controller.postMessage({  
          action: "iniciar",  
          codigo: codigoConductor,  
        });  
      }  
    }  

    // Manejar el envío del código del conductor  
    document.getElementById("btnEnviar").addEventListener("click", () => {  
      const codigoConductor = document.getElementById("codigoConductor").value;  
      if (codigoConductor) {  
        iniciarUbicacionSegundoPlano(codigoConductor);  
      }  
    });  

    // Escuchar mensajes del Service Worker  
    navigator.serviceWorker.addEventListener("message", (event) => {  
      if (event.data.action === "actualizarMensaje") {  
        document.getElementById("mensajeUbicacion").innerText = event.data.mensaje;  
      }  
    });  

    // Registrar el Service Worker  
    if ("serviceWorker" in navigator) {  
      navigator.serviceWorker  
        .register("/sw.js")  
        .then((registration) => {  
          console.log("Service Worker registrado con éxito:", registration);  
        })  
        .catch((error) => {  
          console.error("Error al registrar el Service Worker:", error);  
        });  
    }  
  </script>  
</body>  

</html>  
